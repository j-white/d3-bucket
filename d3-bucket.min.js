/*! d3-bucket 2014-03-29 */
var Bucket=function(a){"use strict";this.initialize=function(a){var b,c,d=500,e=350,f=40,g=50,h=0,i=.18,j=6,k=0,l=0;if(!a.element)throw"Bucket needs a reference to an element";if(1!==a.element.nodeType)throw"Bucket element was defined but not an HTML element";this.element=a.element,"undefined"!=typeof window&&(c=window.getComputedStyle(this.element,null),k=parseInt(c.getPropertyValue("width"),0),l=parseInt(c.getPropertyValue("height"),0)),this.width(a.width||k||d),this.height(a.height||l||e),this.margin(void 0!==a.margin?a.margin:f),this.level(void 0!==a.level?a.level:g),b=function(a){return 75>a?"green":90>a?"yellow":"red"},this.fillColor(void 0!==a.fillColor?a.fillColor:b),this.phase(void 0!==a.phase?a.phase:h),this.frequency(void 0!==a.frequency?a.frequency:i),this.amplitude(void 0!==a.amplitude?a.amplitude:j),this.timeShift(void 0!==a.timeShift?a.timeShift:Math.random()*Math.PI),this.svg=d3.select(this.element).append("svg:svg").attr("width",this._width).attr("height",this._height)},this._onDimensionChange=function(){if(void 0!==this._width&&void 0!==this._height&&void 0!==this._margin){void 0!==this.svg&&this.svg.attr("width",this._width).attr("height",this._height);var a=d3.scale.linear().domain([0,100]).range([this._margin,this._width-this._margin]),b=d3.scale.linear().domain([0,100]).range([this._height-this._margin,this._margin]);this._line=d3.svg.line().x(function(b){return a(b.x)}).y(function(a){return b(a.y)}).interpolate("linear")}},this.width=function(a){return void 0===a?this._width:(this._width=a,this._onDimensionChange(),this)},this.height=function(a){return void 0===a?this._height:(this._height=a,this._onDimensionChange(),this)},this.margin=function(a){return void 0===a?this._margin:(this._margin=a,this._onDimensionChange(),this)},this.level=function(a){return void 0===a?this._level:(this._level=a,this)},this.phase=function(a){return void 0===a?this._phase:(this._phase=a,this)},this.frequency=function(a){return void 0===a?this._frequency:(this._frequency=a,this)},this.amplitude=function(a){return void 0===a?this._amplitude:(this._amplitude=a,this)},this.timeShift=function(a){return void 0===a?this._timeShift:(this._timeShift=a,this)},this.fillColor=function(a){return void 0===a?this._fillColor:(this._fillColor=a,this)},this._generateWaveVector=function(a){var b=this._level,c=this._amplitude*(b/100);c=Math.max(c,1);var d=d3.scale.linear().domain([-1,1]).range([Math.max(0,b-1),Math.min(b+c-1,101)]),e=this._timeShift,f=this._frequency,g=this._phase,h=function(a,b){return Math.cos(b+e)*Math.sin(f*a+g)},i=d3.range(100).map(function(b){return{x:b,y:d(h(b,a))}}),j=[{x:0,y:0},{x:0,y:b}],k=[{x:100,y:b},{x:100,y:0},{x:0,y:0}];return j.concat(i).concat(k)},this._renderFill=function(a){var b=this.svg.select("#fillPath");b.empty()&&(b=this.svg.append("path").attr("id","fillPath").attr("class","line")),b.attr("fill",this._fillColor(this.level())).attr("stroke",this._fillColor(this.level())).attr("d",this._line(this._generateWaveVector(a)))},this._renderContour=function(){var a=[{x:0,y:100},{x:0,y:0},{x:100,y:0},{x:100,y:100}];this.svg.select("#bucketContour").remove(),this.svg.append("path").attr("id","bucketContour").attr("fill","none").attr("stroke","black").attr("stroke-width",4).attr("d",this._line(a))},this._render=function(a){this._renderFill(a),this._renderContour()},this.render=function(a){void 0!==this._renderInterval&&(clearInterval(this._renderInterval),this._renderInterval=void 0),this.svg.selectAll("*").remove();var b=this,c=0;return b._render(c),a?this:(this._renderInterval=setInterval(function(){b._render(c),c+=100},100),this)},this.initialize(a)};